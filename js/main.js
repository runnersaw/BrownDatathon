
var country_location_string = "AD,42.546245,1.601554,Andorra\nAE,23.424076,53.847818,United Arab Emirates\nAF,33.93911,67.709953,Afghanistan\nAG,17.060816,-61.796428,Antigua and Barbuda\nAI,18.220554,-63.068615,Anguilla\nAL,41.153332,20.168331,Albania\nAM,40.069099,45.038189,Armenia\nAN,12.226079,-69.060087,Netherlands Antilles\nAO,-11.202692,17.873887,Angola\nAQ,-75.250973,-0.071389,Antarctica\nAR,-38.416097,-63.616672,Argentina\nAS,-14.270972,-170.132217,American Samoa\nAT,47.516231,14.550072,Austria\nAU,-25.274398,133.775136,Australia\nAW,12.52111,-69.968338,Aruba\nAZ,40.143105,47.576927,Azerbaijan\nBA,43.915886,17.679076,Bosnia and Herzegovina\nBB,13.193887,-59.543198,Barbados\nBD,23.684994,90.356331,Bangladesh\nBE,50.503887,4.469936,Belgium\nBF,12.238333,-1.561593,Burkina Faso\nBG,42.733883,25.48583,Bulgaria\nBH,25.930414,50.637772,Bahrain\nBI,-3.373056,29.918886,Burundi\nBJ,9.30769,2.315834,Benin\nBM,32.321384,-64.75737,Bermuda\nBN,4.535277,114.727669,Brunei\nBO,-16.290154,-63.588653,Bolivia\nBR,-14.235004,-51.92528,Brazil\nBS,25.03428,-77.39628,Bahamas\nBT,27.514162,90.433601,Bhutan\nBV,-54.423199,3.413194,Bouvet Island\nBW,-22.328474,24.684866,Botswana\nBY,53.709807,27.953389,Belarus\nBZ,17.189877,-88.49765,Belize\nCA,56.130366,-106.346771,Canada\nCC,-12.164165,96.870956,Cocos [Keeling] Islands\nCD,-4.038333,21.758664,Congo [DRC]\nCF,6.611111,20.939444,Central African Republic\nCG,-0.228021,15.827659,Congo [Republic]\nCH,46.818188,8.227512,Switzerland\nCI,7.539989,-5.54708,Côte d'Ivoire\nCK,-21.236736,-159.777671,Cook Islands\nCL,-35.675147,-71.542969,Chile\nCM,7.369722,12.354722,Cameroon\nCN,35.86166,104.195397,China\nCO,4.570868,-74.297333,Colombia\nCR,9.748917,-83.753428,Costa Rica\nCU,21.521757,-77.781167,Cuba\nCV,16.002082,-24.013197,Cape Verde\nCX,-10.447525,105.690449,Christmas Island\nCY,35.126413,33.429859,Cyprus\nCZ,49.817492,15.472962,Czech Republic\nDE,51.165691,10.451526,Germany\nDJ,11.825138,42.590275,Djibouti\nDK,56.26392,9.501785,Denmark\nDM,15.414999,-61.370976,Dominica\nDO,18.735693,-70.162651,Dominican Republic\nDZ,28.033886,1.659626,Algeria\nEC,-1.831239,-78.183406,Ecuador\nEE,58.595272,25.013607,Estonia\nEG,26.820553,30.802498,Egypt\nEH,24.215527,-12.885834,Western Sahara\nER,15.179384,39.782334,Eritrea\nES,40.463667,-3.74922,Spain\nET,9.145,40.489673,Ethiopia\nFI,61.92411,25.748151,Finland\nFJ,-16.578193,179.414413,Fiji\nFK,-51.796253,-59.523613,Falkland Islands [Islas Malvinas]\nFM,7.425554,150.550812,Micronesia\nFO,61.892635,-6.911806,Faroe Islands\nFR,46.227638,2.213749,France\nGA,-0.803689,11.609444,Gabon\nGB,55.378051,-3.435973,United Kingdom\nGD,12.262776,-61.604171,Grenada\nGE,42.315407,43.356892,Georgia\nGF,3.933889,-53.125782,French Guiana\nGG,49.465691,-2.585278,Guernsey\nGH,7.946527,-1.023194,Ghana\nGI,36.137741,-5.345374,Gibraltar\nGL,71.706936,-42.604303,Greenland\nGM,13.443182,-15.310139,Gambia\nGN,9.945587,-9.696645,Guinea\nGP,16.995971,-62.067641,Guadeloupe\nGQ,1.650801,10.267895,Equatorial Guinea\nGR,39.074208,21.824312,Greece\nGS,-54.429579,-36.587909,South Georgia and the South Sandwich Islands\nGT,15.783471,-90.230759,Guatemala\nGU,13.444304,144.793731,Guam\nGW,11.803749,-15.180413,Guinea-Bissau\nGY,4.860416,-58.93018,Guyana\nGZ,31.354676,34.308825,Gaza Strip\nHK,22.396428,114.109497,Hong Kong\nHM,-53.08181,73.504158,Heard Island and McDonald Islands\nHN,15.199999,-86.241905,Honduras\nHR,45.1,15.2,Croatia\nHT,18.971187,-72.285215,Haiti\nHU,47.162494,19.503304,Hungary\nID,-0.789275,113.921327,Indonesia\nIE,53.41291,-8.24389,Ireland\nIL,31.046051,34.851612,Israel\nIM,54.236107,-4.548056,Isle of Man\nIN,20.593684,78.96288,India\nIO,-6.343194,71.876519,British Indian Ocean Territory\nIQ,33.223191,43.679291,Iraq\nIR,32.427908,53.688046,Iran\nIS,64.963051,-19.020835,Iceland\nIT,41.87194,12.56738,Italy\nJE,49.214439,-2.13125,Jersey\nJM,18.109581,-77.297508,Jamaica\nJO,30.585164,36.238414,Jordan\nJP,36.204824,138.252924,Japan\nKE,-0.023559,37.906193,Kenya\nKG,41.20438,74.766098,Kyrgyzstan\nKH,12.565679,104.990963,Cambodia\nKI,-3.370417,-168.734039,Kiribati\nKM,-11.875001,43.872219,Comoros\nKN,17.357822,-62.782998,Saint Kitts and Nevis\nKP,40.339852,127.510093,North Korea\nKR,35.907757,127.766922,South Korea\nKW,29.31166,47.481766,Kuwait\nKY,19.513469,-80.566956,Cayman Islands\nKZ,48.019573,66.923684,Kazakhstan\nLA,19.85627,102.495496,Laos\nLB,33.854721,35.862285,Lebanon\nLC,13.909444,-60.978893,Saint Lucia\nLI,47.166,9.555373,Liechtenstein\nLK,7.873054,80.771797,Sri Lanka\nLR,6.428055,-9.429499,Liberia\nLS,-29.609988,28.233608,Lesotho\nLT,55.169438,23.881275,Lithuania\nLU,49.815273,6.129583,Luxembourg\nLV,56.879635,24.603189,Latvia\nLY,26.3351,17.228331,Libya\nMA,31.791702,-7.09262,Morocco\nMC,43.750298,7.412841,Monaco\nMD,47.411631,28.369885,Moldova\nME,42.708678,19.37439,Montenegro\nMG,-18.766947,46.869107,Madagascar\nMH,7.131474,171.184478,Marshall Islands\nMK,41.608635,21.745275,Macedonia [FYROM]\nML,17.570692,-3.996166,Mali\nMM,21.913965,95.956223,Myanmar [Burma]\nMN,46.862496,103.846656,Mongolia\nMO,22.198745,113.543873,Macau\nMP,17.33083,145.38469,Northern Mariana Islands\nMQ,14.641528,-61.024174,Martinique\nMR,21.00789,-10.940835,Mauritania\nMS,16.742498,-62.187366,Montserrat\nMT,35.937496,14.375416,Malta\nMU,-20.348404,57.552152,Mauritius\nMV,3.202778,73.22068,Maldives\nMW,-13.254308,34.301525,Malawi\nMX,23.634501,-102.552784,Mexico\nMY,4.210484,101.975766,Malaysia\nMZ,-18.665695,35.529562,Mozambique\nNA,-22.95764,18.49041,Namibia\nNC,-20.904305,165.618042,New Caledonia\nNE,17.607789,8.081666,Niger\nNF,-29.040835,167.954712,Norfolk Island\nNG,9.081999,8.675277,Nigeria\nNI,12.865416,-85.207229,Nicaragua\nNL,52.132633,5.291266,Netherlands\nNO,60.472024,8.468946,Norway\nNP,28.394857,84.124008,Nepal\nNR,-0.522778,166.931503,Nauru\nNU,-19.054445,-169.867233,Niue\nNZ,-40.900557,174.885971,New Zealand\nOM,21.512583,55.923255,Oman\nPA,8.537981,-80.782127,Panama\nPE,-9.189967,-75.015152,Peru\nPF,-17.679742,-149.406843,French Polynesia\nPG,-6.314993,143.95555,Papua New Guinea\nPH,12.879721,121.774017,Philippines\nPK,30.375321,69.345116,Pakistan\nPL,51.919438,19.145136,Poland\nPM,46.941936,-56.27111,Saint Pierre and Miquelon\nPN,-24.703615,-127.439308,Pitcairn Islands\nPR,18.220833,-66.590149,Puerto Rico\nPS,31.952162,35.233154,Palestinian Territories\nPT,39.399872,-8.224454,Portugal\nPW,7.51498,134.58252,Palau\nPY,-23.442503,-58.443832,Paraguay\nQA,25.354826,51.183884,Qatar\nRE,-21.115141,55.536384,Réunion\nRO,45.943161,24.96676,Romania\nRS,44.016521,21.005859,Serbia\nRU,61.52401,105.318756,Russia\nRW,-1.940278,29.873888,Rwanda\nSA,23.885942,45.079162,Saudi Arabia\nSB,-9.64571,160.156194,Solomon Islands\nSC,-4.679574,55.491977,Seychelles\nSD,12.862807,30.217636,Sudan\nSE,60.128161,18.643501,Sweden\nSG,1.352083,103.819836,Singapore\nSH,-24.143474,-10.030696,Saint Helena\nSI,46.151241,14.995463,Slovenia\nSJ,77.553604,23.670272,Svalbard and Jan Mayen\nSK,48.669026,19.699024,Slovakia\nSL,8.460555,-11.779889,Sierra Leone\nSM,43.94236,12.457777,San Marino\nSN,14.497401,-14.452362,Senegal\nSO,5.152149,46.199616,Somalia\nSR,3.919305,-56.027783,Suriname\nST,0.18636,6.613081,São Tomé and Príncipe\nSV,13.794185,-88.89653,El Salvador\nSY,34.802075,38.996815,Syria\nSZ,-26.522503,31.465866,Swaziland\nTC,21.694025,-71.797928,Turks and Caicos Islands\nTD,15.454166,18.732207,Chad\nTF,-49.280366,69.348557,French Southern Territories\nTG,8.619543,0.824782,Togo\nTH,15.870032,100.992541,Thailand\nTJ,38.861034,71.276093,Tajikistan\nTK,-8.967363,-171.855881,Tokelau\nTL,-8.874217,125.727539,Timor-Leste\nTM,38.969719,59.556278,Turkmenistan\nTN,33.886917,9.537499,Tunisia\nTO,-21.178986,-175.198242,Tonga\nTR,38.963745,35.243322,Turkey\nTT,10.691803,-61.222503,Trinidad and Tobago\nTV,-7.109535,177.64933,Tuvalu\nTW,23.69781,120.960515,Taiwan\nTZ,-6.369028,34.888822,Tanzania\nUA,48.379433,31.16558,Ukraine\nUG,1.373333,32.290275,Uganda\nUM,,,U.S. Minor Outlying Islands\nUS,37.09024,-95.712891,United States\nUY,-32.522779,-55.765835,Uruguay\nUZ,41.377491,64.585262,Uzbekistan\nVA,41.902916,12.453389,Vatican City\nVC,12.984305,-61.287228,Saint Vincent and the Grenadines\nVE,6.42375,-66.58973,Venezuela\nVG,18.420695,-64.639968,British Virgin Islands\nVI,18.335765,-64.896335,U.S. Virgin Islands\nVN,14.058324,108.277199,Vietnam\nVU,-15.376706,166.959158,Vanuatu\nWF,-13.768752,-177.156097,Wallis and Futuna\nWS,-13.759029,-172.104629,Samoa\nXK,42.602636,20.902977,Kosovo\nYE,15.552727,48.516388,Yemen\nYT,-12.8275,45.166244,Mayotte\nZA,-30.559482,22.937506,South Africa\nZM,-13.133897,27.849332,Zambia\nZW,-19.015438,29.154857,Zimbabwe"

var country_locations = processData(country_location_string);

var isoCountries = {
    'AF' : 'Afghanistan',
    'AX' : 'Aland Islands',
    'AL' : 'Albania',
    'DZ' : 'Algeria',
    'AS' : 'American Samoa',
    'AD' : 'Andorra',
    'AO' : 'Angola',
    'AI' : 'Anguilla',
    'AQ' : 'Antarctica',
    'AG' : 'Antigua And Barbuda',
    'AR' : 'Argentina',
    'AM' : 'Armenia',
    'AW' : 'Aruba',
    'AU' : 'Australia',
    'AT' : 'Austria',
    'AZ' : 'Azerbaijan',
    'BS' : 'Bahamas',
    'BH' : 'Bahrain',
    'BD' : 'Bangladesh',
    'BB' : 'Barbados',
    'BY' : 'Belarus',
    'BE' : 'Belgium',
    'BZ' : 'Belize',
    'BJ' : 'Benin',
    'BM' : 'Bermuda',
    'BT' : 'Bhutan',
    'BO' : 'Bolivia',
    'BA' : 'Bosnia And Herzegovina',
    'BW' : 'Botswana',
    'BV' : 'Bouvet Island',
    'BR' : 'Brazil',
    'IO' : 'British Indian Ocean Territory',
    'BN' : 'Brunei Darussalam',
    'BG' : 'Bulgaria',
    'BF' : 'Burkina Faso',
    'BI' : 'Burundi',
    'KH' : 'Cambodia',
    'CM' : 'Cameroon',
    'CA' : 'Canada',
    'CV' : 'Cape Verde',
    'KY' : 'Cayman Islands',
    'CF' : 'Central African Republic',
    'TD' : 'Chad',
    'CL' : 'Chile',
    'CN' : 'China',
    'CX' : 'Christmas Island',
    'CC' : 'Cocos (Keeling) Islands',
    'CO' : 'Colombia',
    'KM' : 'Comoros',
    'CG' : 'Congo',
    'CD' : 'Congo, Democratic Republic',
    'CK' : 'Cook Islands',
    'CR' : 'Costa Rica',
    'CI' : 'Cote D\'Ivoire',
    'HR' : 'Croatia',
    'CU' : 'Cuba',
    'CY' : 'Cyprus',
    'CZ' : 'Czech Republic',
    'DK' : 'Denmark',
    'DJ' : 'Djibouti',
    'DM' : 'Dominica',
    'DO' : 'Dominican Republic',
    'EC' : 'Ecuador',
    'EG' : 'Egypt',
    'SV' : 'El Salvador',
    'GQ' : 'Equatorial Guinea',
    'ER' : 'Eritrea',
    'EE' : 'Estonia',
    'ET' : 'Ethiopia',
    'FK' : 'Falkland Islands (Malvinas)',
    'FO' : 'Faroe Islands',
    'FJ' : 'Fiji',
    'FI' : 'Finland',
    'FR' : 'France',
    'GF' : 'French Guiana',
    'PF' : 'French Polynesia',
    'TF' : 'French Southern Territories',
    'GA' : 'Gabon',
    'GM' : 'Gambia',
    'GE' : 'Georgia',
    'DE' : 'Germany',
    'GH' : 'Ghana',
    'GI' : 'Gibraltar',
    'GR' : 'Greece',
    'GL' : 'Greenland',
    'GD' : 'Grenada',
    'GP' : 'Guadeloupe',
    'GU' : 'Guam',
    'GT' : 'Guatemala',
    'GG' : 'Guernsey',
    'GN' : 'Guinea',
    'GW' : 'Guinea-Bissau',
    'GY' : 'Guyana',
    'HT' : 'Haiti',
    'HM' : 'Heard Island & Mcdonald Islands',
    'VA' : 'Holy See (Vatican City State)',
    'HN' : 'Honduras',
    'HK' : 'Hong Kong',
    'HU' : 'Hungary',
    'IS' : 'Iceland',
    'IN' : 'India',
    'ID' : 'Indonesia',
    'IR' : 'Iran',
    'IQ' : 'Iraq',
    'IE' : 'Ireland',
    'IM' : 'Isle Of Man',
    'IL' : 'Israel',
    'IT' : 'Italy',
    'JM' : 'Jamaica',
    'JP' : 'Japan',
    'JE' : 'Jersey',
    'JO' : 'Jordan',
    'KZ' : 'Kazakhstan',
    'KE' : 'Kenya',
    'KI' : 'Kiribati',
    'KR' : 'Korea',
    'KW' : 'Kuwait',
    'KG' : 'Kyrgyzstan',
    'LA' : 'Lao People\'s Democratic Republic',
    'LV' : 'Latvia',
    'LB' : 'Lebanon',
    'LS' : 'Lesotho',
    'LR' : 'Liberia',
    'LY' : 'Libyan Arab Jamahiriya',
    'LI' : 'Liechtenstein',
    'LT' : 'Lithuania',
    'LU' : 'Luxembourg',
    'MO' : 'Macao',
    'MK' : 'Macedonia',
    'MG' : 'Madagascar',
    'MW' : 'Malawi',
    'MY' : 'Malaysia',
    'MV' : 'Maldives',
    'ML' : 'Mali',
    'MT' : 'Malta',
    'MH' : 'Marshall Islands',
    'MQ' : 'Martinique',
    'MR' : 'Mauritania',
    'MU' : 'Mauritius',
    'YT' : 'Mayotte',
    'MX' : 'Mexico',
    'FM' : 'Micronesia, Federated States Of',
    'MD' : 'Moldova',
    'MC' : 'Monaco',
    'MN' : 'Mongolia',
    'ME' : 'Montenegro',
    'MS' : 'Montserrat',
    'MA' : 'Morocco',
    'MZ' : 'Mozambique',
    'MM' : 'Myanmar',
    'NA' : 'Namibia',
    'NR' : 'Nauru',
    'NP' : 'Nepal',
    'NL' : 'Netherlands',
    'AN' : 'Netherlands Antilles',
    'NC' : 'New Caledonia',
    'NZ' : 'New Zealand',
    'NI' : 'Nicaragua',
    'NE' : 'Niger',
    'NG' : 'Nigeria',
    'NU' : 'Niue',
    'NF' : 'Norfolk Island',
    'MP' : 'Northern Mariana Islands',
    'NO' : 'Norway',
    'OM' : 'Oman',
    'PK' : 'Pakistan',
    'PW' : 'Palau',
    'PS' : 'Palestinian Territory, Occupied',
    'PA' : 'Panama',
    'PG' : 'Papua New Guinea',
    'PY' : 'Paraguay',
    'PE' : 'Peru',
    'PH' : 'Philippines',
    'PN' : 'Pitcairn',
    'PL' : 'Poland',
    'PT' : 'Portugal',
    'PR' : 'Puerto Rico',
    'QA' : 'Qatar',
    'RE' : 'Reunion',
    'RO' : 'Romania',
    'RU' : 'Russia',
    'RW' : 'Rwanda',
    'BL' : 'Saint Barthelemy',
    'SH' : 'Saint Helena',
    'KN' : 'Saint Kitts And Nevis',
    'LC' : 'Saint Lucia',
    'MF' : 'Saint Martin',
    'PM' : 'Saint Pierre And Miquelon',
    'VC' : 'Saint Vincent And Grenadines',
    'WS' : 'Samoa',
    'SM' : 'San Marino',
    'ST' : 'Sao Tome And Principe',
    'SA' : 'Saudi Arabia',
    'SN' : 'Senegal',
    'RS' : 'Serbia',
    'SC' : 'Seychelles',
    'SL' : 'Sierra Leone',
    'SG' : 'Singapore',
    'SK' : 'Slovakia',
    'SI' : 'Slovenia',
    'SB' : 'Solomon Islands',
    'SO' : 'Somalia',
    'ZA' : 'South Africa',
    'GS' : 'South Georgia And Sandwich Isl.',
    'ES' : 'Spain',
    'LK' : 'Sri Lanka',
    'SD' : 'Sudan',
    'SR' : 'Suriname',
    'SJ' : 'Svalbard And Jan Mayen',
    'SZ' : 'Swaziland',
    'SE' : 'Sweden',
    'CH' : 'Switzerland',
    'SY' : 'Syria',
    'TW' : 'Taiwan',
    'TJ' : 'Tajikistan',
    'TZ' : 'Tanzania',
    'TH' : 'Thailand',
    'TL' : 'Timor-Leste',
    'TG' : 'Togo',
    'TK' : 'Tokelau',
    'TO' : 'Tonga',
    'TT' : 'Trinidad And Tobago',
    'TN' : 'Tunisia',
    'TR' : 'Turkey',
    'TM' : 'Turkmenistan',
    'TC' : 'Turks And Caicos Islands',
    'TV' : 'Tuvalu',
    'UG' : 'Uganda',
    'UA' : 'Ukraine',
    'AE' : 'United Arab Emirates',
    'GB' : 'United Kingdom',
    'US' : 'United States of America',
    'UM' : 'United States Outlying Islands',
    'UY' : 'Uruguay',
    'UZ' : 'Uzbekistan',
    'VU' : 'Vanuatu',
    'VE' : 'Venezuela',
    'VN' : 'Viet Nam',
    'VG' : 'Virgin Islands, British',
    'VI' : 'Virgin Islands, U.S.',
    'WF' : 'Wallis And Futuna',
    'EH' : 'Western Sahara',
    'YE' : 'Yemen',
    'ZM' : 'Zambia',
    'ZW' : 'Zimbabwe'
};

var isoAlpha3 = {
	'AF': 'AFG',
	'AL': 'ALB',
	'DZ': 'DZA',
	'AS': 'ASM',
	'AD': 'AND',
	'AO': 'AGO',
	'AI': 'AIA',
	'AQ': 'ATA',
	'AG': 'ATG',
	'AR': 'ARG',
	'AM': 'ARM',
	'AW': 'ABW',
	'AU': 'AUS',
	'AT': 'AUT',
	'AZ': 'AZE',
	'BS': 'BHS',
	'BH': 'BHR',
	'BD': 'BGD',
	'BB': 'BRB',
	'BY': 'BLR',
	'BE': 'BEL',
	'BZ': 'BLZ',
	'BJ': 'BEN',
	'BM': 'BMU',
	'BT': 'BTN',
	'BO': 'BOL',
	'BA': 'BIH',
	'BW': 'BWA',
	'BV': 'BVT',
	'BR': 'BRA',
	'IO': 'IOT',
	'VG': 'VGB',
	'BN': 'BRN',
	'BG': 'BGR',
	'BF': 'BFA',
	'BI': 'BDI',
	'KH': 'KHM',
	'CM': 'CMR',
	'CA': 'CAN',
	'CV': 'CPV',
	'KY': 'CYM',
	'CF': 'CAF',
	'TD': 'TCD',
	'CL': 'CHL',
	'CN': 'CHN',
	'CX': 'CXR',
	'CC': 'CCK',
	'CO': 'COL',
	'KM': 'COM',
	'CD': 'COD',
	'CG': 'COG',
	'CK': 'COK',
	'CR': 'CRI',
	'CI': 'CIV',
	'CU': 'CUB',
	'CY': 'CYP',
	'CZ': 'CZE',
	'DK': 'DNK',
	'DJ': 'DJI',
	'DM': 'DMA',
	'DO': 'DOM',
	'EC': 'ECU',
	'EG': 'EGY',
	'SV': 'SLV',
	'GQ': 'GNQ',
	'ER': 'ERI',
	'EE': 'EST',
	'ET': 'ETH',
	'FO': 'FRO',
	'FK': 'FLK',
	'FJ': 'FJI',
	'FI': 'FIN',
	'FR': 'FRA',
	'GF': 'GUF',
	'PF': 'PYF',
	'TF': 'ATF',
	'GA': 'GAB',
	'GM': 'GMB',
	'GE': 'GEO',
	'DE': 'DEU',
	'GH': 'GHA',
	'GI': 'GIB',
	'GR': 'GRC',
	'GL': 'GRL',
	'GD': 'GRD',
	'GP': 'GLP',
	'GU': 'GUM',
	'GT': 'GTM',
	'GN': 'GIN',
	'GW': 'GNB',
	'GY': 'GUY',
	'HT': 'HTI',
	'HM': 'HMD',
	'VA': 'VAT',
	'HN': 'HND',
	'HK': 'HKG',
	'HR': 'HRV',
	'HU': 'HUN',
	'IS': 'ISL',
	'IN': 'IND',
	'ID': 'IDN',
	'IR': 'IRN',
	'IQ': 'IRQ',
	'IE': 'IRL',
	'IL': 'ISR',
	'IT': 'ITA',
	'JM': 'JAM',
	'JP': 'JPN',
	'JO': 'JOR',
	'KZ': 'KAZ',
	'KE': 'KEN',
	'KI': 'KIR',
	'KP': 'PRK',
	'KR': 'KOR',
	'KW': 'KWT',
	'KG': 'KGZ',
	'LA': 'LAO',
	'LV': 'LVA',
	'LB': 'LBN',
	'LS': 'LSO',
	'LR': 'LBR',
	'LY': 'LBY',
	'LI': 'LIE',
	'LT': 'LTU',
	'LU': 'LUX',
	'MO': 'MAC',
	'MK': 'MKD',
	'MG': 'MDG',
	'MW': 'MWI',
	'MY': 'MYS',
	'MV': 'MDV',
	'ML': 'MLI',
	'MT': 'MLT',
	'MH': 'MHL',
	'MQ': 'MTQ',
	'MR': 'MRT',
	'MU': 'MUS',
	'YT': 'MYT',
	'MX': 'MEX',
	'FM': 'FSM',
	'MD': 'MDA',
	'MC': 'MCO',
	'MN': 'MNG',
	'MS': 'MSR',
	'MA': 'MAR',
	'MZ': 'MOZ',
	'MM': 'MMR',
	'NA': 'NAM',
	'NR': 'NRU',
	'NP': 'NPL',
	'AN': 'ANT',
	'NL': 'NLD',
	'NC': 'NCL',
	'NZ': 'NZL',
	'NI': 'NIC',
	'NE': 'NER',
	'NG': 'NGA',
	'NU': 'NIU',
	'NF': 'NFK',
	'MP': 'MNP',
	'NO': 'NOR',
	'OM': 'OMN',
	'PK': 'PAK',
	'PW': 'PLW',
	'PS': 'PSE',
	'PA': 'PAN',
	'PG': 'PNG',
	'PY': 'PRY',
	'PE': 'PER',
	'PH': 'PHL',
	'PN': 'PCN',
	'PL': 'POL',
	'PT': 'PRT',
	'PR': 'PRI',
	'QA': 'QAT',
	'RE': 'REU',
	'RO': 'ROU',
	'RU': 'RUS',
	'RW': 'RWA',
	'SH': 'SHN',
	'KN': 'KNA',
	'LC': 'LCA',
	'PM': 'SPM',
	'VC': 'VCT',
	'WS': 'WSM',
	'SM': 'SMR',
	'ST': 'STP',
	'SA': 'SAU',
	'SN': 'SEN',
	'CS': 'SCG',
	'SC': 'SYC',
	'SL': 'SLE',
	'SG': 'SGP',
	'SK': 'SVK',
	'SI': 'SVN',
	'SB': 'SLB',
	'SO': 'SOM',
	'ZA': 'ZAF',
	'GS': 'SGS',
	'ES': 'ESP',
	'LK': 'LKA',
	'SD': 'SDN',
	'SR': 'SUR',
	'SJ': 'SJM',
	'SZ': 'SWZ',
	'SE': 'SWE',
	'CH': 'CHE',
	'SY': 'SYR',
	'TW': 'TWN',
	'TJ': 'TJK',
	'TZ': 'TZA',
	'TH': 'THA',
	'TL': 'TLS',
	'TG': 'TGO',
	'TK': 'TKL',
	'TO': 'TON',
	'TT': 'TTO',
	'TN': 'TUN',
	'TR': 'TUR',
	'TM': 'TKM',
	'TC': 'TCA',
	'TV': 'TUV',
	'VI': 'VIR',
	'UG': 'UGA',
	'UA': 'UKR',
	'AE': 'ARE',
	'GB': 'GBR',
	'UM': 'UMI',
	'US': 'USA',
	'UY': 'URY',
	'UZ': 'UZB',
	'VU': 'VUT',
	'VE': 'VEN',
	'VN': 'VNM',
	'WF': 'WLF',
	'EH': 'ESH',
	'YE': 'YEM',
	'ZM': 'ZMB',
	'ZW': 'ZWE'
}

function getCountryName(countryCode) {
    if (isoCountries.hasOwnProperty(countryCode)) {
        return isoCountries[countryCode];
    } else {
        return countryCode;
    }
}

function getCountryCode(countryName) {
    for (var key in isoCountries) {
    	if (isoCountries[key].toLowerCase() == countryName.toLowerCase()) {
    		return key;
    	}
    }
    console.log('no country '+countryName);
}

function getCountryCode3(countryCode) {
	return isoAlpha3[countryCode.toUpperCase()];
}

function processData(allText) {
    var allTextLines = allText.split(/\r\n|\n/);
    var dict = {};

    for (var i=0; i<allTextLines.length; i++) {
        var data = allTextLines[i].split(',');
        dict[data[3].toLowerCase()] = [parseFloat(data[1]), parseFloat(data[2])];
        dict[data[0].toLowerCase()] = [parseFloat(data[1]), parseFloat(data[2])];
    }
    return dict;
}

function getCountryLocation(country) {
	return country_locations[country.toLowerCase()];
}

var map;
var selectedCountry = 'US'
var selectedData = undefined;
var bubbles = [];
var arcs = [];

function createMap() {
	data = {}
	if (selectedData) {
		for (var key in selectedData) {
			data[getCountryCode3(key)] = {
				'fillKey': 'attacking',
				'attacks': selectedData[key],
				'attacking': true
			}
		}
	}
	console.log(data);

	map = new Datamap({
		element: document.getElementById('container'),
		projection: 'mercator',
		responsive: true,
		scope: "world",
	    done: function(datamap) {
	        datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
	            load_country(getCountryCode(geography.properties.name));
	        });
	    },
		fills: {
			defaultFill: '#ABDDA4',
			attacking: '#ff232e'
		},
		geographyConfig: {
			highlightBorderColor: '#bada55',
			popupTemplate: function(geography, data) {
				if (data.attacking) {
					return '<div class="hoverinfo">Attacks on '+getCountryName(selectedCountry)+' by groups from '+geography.properties.name+': '+data.attacks
				}
			},
			highlightBorderWidth: 3
		},
		data: data
	});

	mx = 0;
	for (var key in selectedData) {
		var val = selectedData[key];
		if (val > mx) {
			mx = val;
		}
	}
	for (var key in selectedData) {
		width = 10*selectedData[key]/mx;
		if (width < 1) {
			width = 1;
		}
		draw_arc_country(key, selectedCountry, width);
	}
}

createMap();

function draw_bubble(country, radius) {
	bubbles.push({
		radius: radius,
		centered: country,
	});
	map.bubbles(bubbles);
}

function clear_arcs() {
	arcs = [];
	map.arc(arcs, {strokeWidth: 1, arcSharpness: 1.4});
}

function draw_arc_country(origin, destination, width) {
	o = getCountryLocation(origin);
	d = getCountryLocation(destination);
	if (!o || !d) {
		console.log('nope');
		return;
	}
	draw_arc(o[0], o[1], d[0], d[1], width);
}

function draw_arc(origin_lat, origin_long, destination_lat, destination_long, width) {
	arcs.push({
		origin: {
			latitude: origin_lat,
			longitude: origin_long
		},
		destination: {
			latitude: destination_lat,
			longitude: destination_long
		},
		options: {
			strokeWidth: width,
        	strokeColor: 'rgba(100, 10, 200, 0.4)'
		}
	});
	map.arc(arcs, {strokeWidth: width, arcSharpness: 1.4});
}

function load_country(country) {
	if (!country) {
		return;
	}
	clear_arcs();
	$.getJSON("./js/attacks.json", function(json) {
		attacks = json[country.toUpperCase()];
		selectedCountry = country;
		selectedData = attacks;
		$('#container').empty();
		createMap();
	});
}


